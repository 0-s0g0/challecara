name: PR Name Check

on:
  pull_request:
    types: [opened, edited, synchronize, reopened]

jobs:
  check-pr-title:
    name: Check PR Title Format
    runs-on: ubuntu-latest

    steps:
      - name: Check PR title naming convention
        env:
          PR_TITLE: ${{ github.event.pull_request.title }}
        run: |
          echo "Checking PR title: $PR_TITLE"

          # 許可されたプレフィックス
          ALLOWED_PREFIXES="feat|fix|docs|chore|refactor|test|style|perf|ci"

          # 正規表現パターン: プレフィックス + コロン + 半角スペース + 説明
          # スコープは許可しない
          PATTERN="^(${ALLOWED_PREFIXES}): .+$"

          if echo "$PR_TITLE" | grep -Eq "$PATTERN"; then
            echo "✅ PR title follows the naming convention!"
            echo "Format: $PR_TITLE"
            exit 0
          else
            echo "❌ PR title does not follow the naming convention!"
            echo ""
            echo "Current title: $PR_TITLE"
            echo ""
            echo "Expected format: <type>: <description>"
            echo ""
            echo "Allowed types:"
            echo "  - feat:     新機能の追加"
            echo "  - fix:      バグ修正"
            echo "  - docs:     ドキュメントの変更"
            echo "  - chore:    ビルドプロセスや補助ツールの変更"
            echo "  - refactor: リファクタリング"
            echo "  - test:     テストの追加・修正"
            echo "  - style:    コードスタイルの変更"
            echo "  - perf:     パフォーマンス改善"
            echo "  - ci:       CI設定の変更"
            echo ""
            echo "Examples:"
            echo "  ✅ feat: ユーザー認証機能を追加"
            echo "  ✅ fix: ログイン時のエラーを修正"
            echo "  ✅ docs: READMEを更新"
            echo "  ❌ feat(api): 新しいAPIを追加 (スコープは許可されていません)"
            echo "  ❌ feat:説明 (コロンの後に半角スペースが必要です)"
            echo ""
            exit 1
          fi
